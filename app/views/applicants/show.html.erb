<h1 class="page-header">Applicant's Information</h1>
<div class="row">

  <div class="col-md-6 col-xs-12">
    <div class="row">
      <div class="col-md-12">
        <div class="panel panel-primary ap_info">
          <div class="panel-heading">
            <% if File.exists?("#{RAILS_ROOT}/public/images/#{@applicant.image_name}") %>
              <%= image_tag "#{@applicant.image_name}" , :size => "200x200" , :class=>"img-circle" %>
            <% else %>
              <%= image_tag('404.jpg' , :size => "200x200") %>
            <% end %>
            &nbsp;
          </div>

          <h1 class="page-header text-right"><%= @applicant.lastname %>,
              <%= @applicant.firstname %> &nbsp;
              <%= @applicant.middlename %>
              </h1>
          <div class="clearfix"></div>

          <div class="panel-body">
            <p>  <label>Email Address:</label>  <%= @applicant.email_address %>   </p>
            <p>  <label>Contact Number:</label>       <%= @applicant.contact %>   </p>
            <p>  <label>Birthday: </label>               <%= @applicant.bday %>   </p>
            <p>  <label>Gender: </label>               <%= @applicant.gender %>   </p>
            <p>  <label>Highest School Attainment: </label>
                                    <%= @applicant.highest_school_attainment %>   </p>
            <p>  <label>Address: </label>
                                      <address><%= @applicant.address %></address></p>
          </div>
        </div>
        <% if flash[:notice] %>
          <div class="alert">
              <%= flash[:notice] %>
          </div>
      <% end %>
      </div>
    </div>
  </div>

  <div class="col-md-6 col-xs-12">

    <div class="col-md-12">
      <div class="row">
          <div class="panel panel-primary">
            <div class="panel-heading">Add Exam</div>
              <div class="panel-body">
                <% if @exam_list.count > 0%>
                  <%= form_tag assign_grade_path(@applicant) do%>
                    <%= select_tag 'exam', options_from_collection_for_select(@exam_list, 'id', 'title')%>
                    <%= submit_tag 'add exam'%>
                  <% end %>
                <%else%>
                  ALL exams for <%= @applicant.position.title %> were taken
                <% end %>
              </div>
          </div>
      </div>


    </div>

    <div class="col-md-12">
      <div class="row">
        <div class="panel panel-primary">
          <div class="panel-heading">Exam List</div>
            <div class="panel-body">
              <table class="table table-default table-responsive">
                <thead>
                  <th>Exam Title</th>
                  <th>Score</th>
                  <th>Remarks</th>
                  <th></th>
                </thead>
                <%@exams = @applicant.exams%>
                <%@exams.each do |exam|%>
                <tr>
                  <td><%= exam.title %></td>
                  <% grade = exam.grades.find_by_applicant_id(@applicant) %>
                  <td><%= grade.score %></td>
                  <td><%= grade.remarks %></td>
                  <td><%= link_to  'Grade', '#', 'data-toggle' => "modal",
       'data-target' => '#gradeModal','data-id' => exam.id,
       'data-action' => update_grade_path(@applicant,exam),
       'data-score' => exam.grades.find_by_applicant_id(@applicant).score,
       'data-remarks' => exam.grades.find_by_applicant_id(@applicant).remarks %></td>
                </tr>
                <% end %>
              </table>
            </div>
        </div>
      </div>
    </div>

    <div class="col-md-12">
      <div class="row">
        <div class="panel panel-primary">
          <div class="panel-heading">Options</div>
            <div class="panel-body">
              <a href="#" class="btn btn-info">Assign Interviewer</a>
              <a href="#" class="btn btn-warning">Skip Exam</a>
            </div>
        </div>
      </div>
      </div>
  </div>
</div>

<%= link_to 'Edit', edit_applicant_path(@applicant) %> |
<%= link_to 'Remove', @applicant, :confirm => 'Are you sure?', :method => :delete, :action => :destroy %> |
<%= link_to 'Okey', applicants_url %>




<div class="modal fade" id="gradeModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">

      <div class="modal-header">
        <%unless @edit_error %>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <% end %>
        <h4 class="modal-title" id="myModalLabel">Grade</h4>
      </div>

      <div class="modal-body">
        <% unless @edit_grade %>
          <% @edit_grade = Grade.first%>
        <% end %>

        <% if @edit_grade.errors.any? %>
          <div id="error_explanation" class="alert alert-danger">
            <h4>Grade can't be saved:</h4>

            <ul>
              <% @edit_grade.errors.full_messages.each do |msg| %>
                <li><%= msg %></li>
              <% end %>
            </ul>
          </div>
        <% end %>

        <%= form_for(@edit_grade, :html=> {:id=>"edit_form", :class=>"form-horizontal"}, :method=>:post) do |f| %>
        <div class="field form-group">
          <%= f.label :score, :class=>"control-label col-md-3"%>
          <div class="col-md-9">
            <%= f.text_field :score, :id=>"inputScore", :class=>"form-control" %>
          </div>
        </div>

        <div class="field form-group">
          <%= f.label :remarks, :class=>"control-label col-md-3"%>
          <div class="col-md-9">
            <%= f.text_field :remarks, :id=>"inputRemarks", :class=>"form-control" %>
          </div>
        </div>

      </div>
      <div class="modal-footer">
        <%if @edit_error %>
        <%= link_to "Back", positions_path, :class=>"btn btn-default"%>
        <%else%>
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <%end%>
        <%= f.submit :class=>"btn btn-primary" %><%end%>
      </div>

    </div>  <!-- end of modal content -->
  </div> <!-- end of modal-dialog -->
</div> <!-- end of modal -->



<% if @edit_error %>
  <script type="text/javascript">
    $(window).load(function(){
        $('#gradeModal').modal('show');
    });
  </script>
<% end %>


<script type="text/javascript">
  var data_id = 0
  var data_action = "";

  $(document).on('click', 'a', function(event, ui) {
      data_id = $(this).data('id');
      data_action = $(this).data('action')
      data_score = $(this).data('score')
      data_remarks = $(this).data('remarks')
  });


  $('#gradeModal').on('shown.bs.modal', function () {
    document.getElementById("edit_form").action = data_action
    document.getElementById("inputScore").value = !data_score? '':data_score
    document.getElementById("inputRemarks").value = !data_remarks? '':data_remarks
  })


  <% if @edit_error %>
    $('#gradeModal').modal({
      backdrop: 'static',
      keyboard: false
    })

    $('#gradeModal').on('hide.bs.modal', function (e) {

    })
  <% end %>

</script>
