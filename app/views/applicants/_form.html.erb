
<%= form_for @applicant, :html => {:multipart => true} do |f| %>
  <% if @applicant.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@applicant.errors.count, "error") %> prohibited this applicant from being saved:</h2>

      <ul>
      <% @applicant.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
      </ul>
    </div>
  <% end %>
  <div class="field">
    <% if @applicant.image_name.nil? %>
    <% preview = "new_applicant.png" %>
    <% else %>
    <% preview = @applicant.image_name %>
    <% end %>
    
    <%= label_tag "Picture" %><br />
    <canvas id="myCanvas" width="200" height="200"></canvas>
    <input id="base64" type="hidden" value="" name="base64"/>
    <input type='file', name = "applicant[image]", accept="image/*", onchange="readURL(this);", id = "uploader" />
  </div>
  
  <div class="field">
    <%= f.label :lastname %><br />
    <%= f.text_field :lastname %>
  </div>
  <div class="field">
    <%= f.label :firstname %><br />
    <%= f.text_field :firstname %>
  </div>
  <div class="field">
    <%= f.label :middlename %><br />
    <%= f.text_field :middlename %>
  </div>
  <div class="field">
    <%= f.label :bday %><br />
    <%= f.date_select :bday, :start_year => Date.today.year - 15, :end_year => Date.today.year - 100 %>
  </div>
  <div class="field">
    <%= f.label :gender %><br />
    <%= f.select(:gender, ["Male", "Female"], {:prompt => "Select gender"}) %>
  </div>
  <div class="field">
    <%= f.label :highest_school_attainment %><br />
    <%= f.select(:highest_school_attainment, ["Tertiary","Secondary"], {:prompt => "Select"}) %>
  </div>
  <div class="field">
    <%= f.label :address %><br />
    <%= f.text_area :address, :rows=>4, :cols=>40, :alds=>10 %>
  </div>
  <div class="field">
    <%= f.label :email_address %><br />
    <%= f.text_field :email_address %>
  </div>
  <div class="field">
    <%= f.label :contact %><br />
    <%= f.text_field :contact %>
  </div>
  <div class="field">
    <%= f.label :position_id, "Position" %><br />
    <%= f.collection_select(:position_id, Position.all, :id, :title,
      {:prompt=>"Select Position"})  %>
  </div>


  <div class="actions">
    <%= f.submit %>
  </div>
<% end %>

<script type="text/javascript">

function readURL(input) {
    
    if (input.files && input.files[0]) {
        var reader = new FileReader();

        reader.onload = function (e) {
            $('#myCanvas')
                .attr('src', e.target.result);
            var canvas = document.getElementById('myCanvas');
            var context = canvas.getContext('2d');
            var x = 0;
            var y = 0;
            var width = 200;
            var height = 200;
            var imageObj = new Image();

            imageObj.onload = function() {
              context.drawImage(imageObj, x, y, width, height);
              $('#base64').val(canvas.toDataURL());
            };
              imageObj.src = e.target.result;
            }
        };
        reader.readAsDataURL(input.files[0]);
    }

    var canvas = document.getElementById('canvas'),
    context = canvas.getContext('2d');

    function make_base(path)
    {
      base_image = new Image();
      base_image.src = path;
      base_image.onload = function(){
        context.drawImage(base_image, 200, 200);
      }
    }
</script>




